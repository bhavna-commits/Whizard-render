<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Template Preview</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
	<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
	<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
	<link href="assets/plugins/pace/pace-theme-flash.css" rel="stylesheet" type="text/css" />
	<link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	
	<link href="assets/plugins/jquery-scrollbar/jquery.scrollbar.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="assets/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" media="screen" />
	<link class="main-stylesheet" href="pages/css/themes/corporate.css" rel="stylesheet" type="text/css" />
	
	
	
	<link rel="stylesheet" type="text/css" href="styles/template-preview.css" />
	<script src="https://kit.fontawesome.com/44e4e59292.js" crossorigin="anonymous"></script>
	<script src="https://cdn.tailwindcss.com"></script>
	<link href="assets/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" media="screen" />
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet" />
	
</head>
<% if (templateData) { %>

<body class="h-screen w-screen">
	<div class="flex pt-5 pl-10">
		<div class="w-[40%]">
			<h3 class="font-bold text-3xl">
				<%= templateData.templateName %>
			</h3>
			
			<form id="previewForm" class="pt-5">
				<% templateData.dynamicVariables.forEach((variable, index) => { %>
				
				<div class="form-group py-1">
					<label class="font-semibold">
						Enter value for variable
					</label>
					<div class="form-group-default-input">
						<input type="text" class="rounded shadow-sm border full-width input-variable p-2" data-variable="" onchange="updatePreview()" />
					</div>
				</div>
				<!-- <div class="form-group py-1">
					<label class="font-semibold">
						Choose Attributes for <%= variable %></label>
					<div class="form-group-default-select2">
						<select class="rounded shadow-sm border full-width select2-hidden-accessible" data-init-plugin="select2" multiple="" tabindex="-1" aria-hidden="true">
							<option value="Name">Name</option>
							<option value="WhatsApp">WhatsApp</option>
						</select>
					</div>
				</div> -->
				<% }); %>
				
				<button type="button" class="px-2 py-2 bg-orange-300 hover:bg-orange-400 rounded-md text-white drop-shadow-lg hover:shadow-lg transition-all hover:translate-y-1 w-full" onclick="handleSubmit()">
					Submit
				</button>
			</form>
			
		</div>
		<div class="w-[60%] flex justify-center items-center">
			<div class="iphone-container">
				<div class="iphone-screen">
					<div class="card">
						<% if (templateData.header.type !== 'none' && templateData.header.content) { %>
						<% if (templateData.header.contentType === 'image') { %>
						<img src="<%= templateData.header.content %>" class="card-img-top" alt="Header Image" />
						<% } else if (templateData.header.contentType === 'pdf') { %>
						<embed src="<%= templateData.header.content %>#page=1" type="application/pdf" width="100%" height="500px" />
						<% } else if (templateData.header.contentType === 'docx') { %>
						<iframe src="https://view.officeapps.live.com/op/embed.aspx?src=<%= encodeURIComponent(templateData.header.content) %>" width="100%" height="500px" frameborder="0"></iframe>
						<% } else if (templateData.header.contentType === 'video') { %>
						<video controls class="card-img-top" width="100%">
							<source src="<%= templateData.header.content %>" type="video/mp4" />
							Your browser does not support the video tag.
						</video>
						<% } else if (templateData.header.contentType === 'location') { %>
						<iframe width="100%" height="300px" src="https://www.google.com/maps/embed/v1/place?key=YOUR_GOOGLE_MAPS_API_KEY&q=<%= encodeURIComponent(templateData.header.content) %>" frameborder="0" style="border: 0" allowfullscreen="">
						</iframe>
						<% } else if (templateData.header.type === 'text'){ %>
						<p class="card-text text-sm font-bold pb-2" id="previewHeader">
							<%- templateData.header.content.replace(/(\r\n|\n|\r)/g, '<br>') %>
						</p>
						<img src="https://via.placeholder.com/360x180" class="card-img-top" alt="Image" />
						<% } %> <% } %>
						
						<div class="card-body">
							<p class="card-text text-sm pb-2" id="previewBody">
								<%- templateData.body.replace(/(\r\n|\n|\r)/g, '<br>') %>
							</p>
							<p class="card-text text-sm font-medium pb-3" id="previewFooter">
								<small class="text-muted"><%= templateData.footer.replace(/(\r\n|\n|\r)/g, '<br>') %></small>
							</p>
							<% templateData.buttons.forEach(button => { %>
							<a href="<%= button.urlPhone.startsWith('http') ? button.urlPhone : 'tel:' + button.urlPhone %>" class="btn border-gray-200 border-b-0 border-x-0 text-blue-500 text-xs">
								<i class="pr-1 <%= button.urlPhone.startsWith('http') ? 'fa-solid fa-arrow-up-right-from-square' : 'fa-solid fa-phone'%>"></i>
								
								<%= button.text || (button.urlPhone.startsWith('http') ? 'Visit Now' : 'Call Now') %>
							</a>
							<% }); %>
							
							
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="modal fade" id="templateModal" tabindex="-1" aria-labelledby="templateModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-xl">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="templateModalLabel"><%= templateData.templateName %></h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div class="row">
						<div class="col-md-5">
							<form id="previewForm">
								<% templateData.dynamicVariables.forEach((variable, index) => { %>
								<div class="form-group py-1">
									<label class="font-semibold">Choose Attributes for <%= variable %></label>
									<div class="form-group-default-select2">
										<select class="rounded shadow-sm border full-width select2-hidden-accessible" data-init-plugin="select2" multiple="" tabindex="-1" aria-hidden="true">
											<option value="Name">Name</option>
											<option value="WhatsApp">WhatsApp</option>
										</select>
									</div>
								</div>
								<% }); %>
							</form>
						</div>
						
						<div class="col-md-7 d-flex justify-content-center align-items-center">
							<div class="iphone-container">
								<div class="iphone-screen">
									<div class="card">
										<!-- Display the preview content -->
										<% if (templateData.header.type !== 'none' && templateData.header.content) { %>
										<% if (templateData.header.contentType === 'image') { %>
										<img src="<%= templateData.header.content %>" class="card-img-top" alt="Header Image" />
										<% } else if (templateData.header.contentType === 'pdf') { %>
										<embed src="<%= templateData.header.content %>#page=1" type="application/pdf" width="100%" height="500px" />
										<% } else if (templateData.header.contentType === 'docx') { %>
										<iframe src="https://view.officeapps.live.com/op/embed.aspx?src=<%= encodeURIComponent(templateData.header.content) %>" width="100%" height="500px" frameborder="0"></iframe>
										<% } else if (templateData.header.contentType === 'video') { %>
										<video controls class="card-img-top" width="100%">
											<source src="<%= templateData.header.content %>" type="video/mp4" />
											Your browser does not support the video tag.
										</video>
										<% } else if (templateData.header.contentType === 'location') { %>
										<iframe width="100%" height="300px" src="https://www.google.com/maps/embed/v1/place?key=YOUR_GOOGLE_MAPS_API_KEY&q=<%= encodeURIComponent(templateData.header.content) %>" frameborder="0" style="border: 0" allowfullscreen="">
										</iframe>
										<% } else if (templateData.header.type === 'text'){ %>
										<p class="card-text text-sm font-bold pb-2" id="previewHeader">
											<%- templateData.header.content.replace(/(\r\n|\n|\r)/g, '<br>') %>
										</p>
										<img src="https://via.placeholder.com/360x180" class="card-img-top" alt="Image" />
										<% } %> <% } %>
										<div class="card-body">
											<p class="card-text text-sm" id="previewBody">
												<%- templateData.body.replace(/(\r\n|\n|\r)/g, '<br>') %>
											</p>
											<p class="card-text text-sm" id="previewFooter">
												<small class="text-muted"><%= templateData.footer.replace(/(\r\n|\n|\r)/g, '<br>') %></small>
											</p>
											<!-- Display buttons -->
											<% templateData.buttons.forEach(button => { %>
											<a href="<%= button.urlPhone.startsWith('http') ? button.urlPhone : 'tel:' + button.urlPhone %>" class="btn btn-sm btn-outline-primary">
												<i class="pr-1 <%= button.urlPhone.startsWith('http') ? 'fa-solid fa-arrow-up-right-from-square' : 'fa-solid fa-phone'%>"></i>
												<%= button.text || (button.urlPhone.startsWith('http') ? 'Visit Now' : 'Call Now') %>
											</a>
											<% }); %>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				
				<div class="modal-footer">
					<!-- Close button -->
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
					<!-- Submit button -->
					<button type="button" id="submitTemplate" class="btn btn-primary" onclick="submit()">Submit</button>
				</div>
			</div>
		</div>
	</div>
	
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	
	<script>
		const templateData = <%- JSON.stringify(templateData) %>;
		
		
		function updatePreview () {
			const formData = {};
			
			// Loop through each input element and update formData based on entered value
			document.querySelectorAll('.input-variable').forEach(inputElement => {
				const variable = inputElement.getAttribute('data-variable');
				const index = inputElement.getAttribute('data-index'); // Get the index of the variable
				const enteredValue = inputElement.value || ''; // Get entered value
				formData[index] = enteredValue; // Store in formData by index
			});
			
			// Now update the preview based on formData
			updatePreviewContent(formData);
		}
		
		// Function to update the preview content
		function updatePreviewContent (formData) {
			console.log('Form Data:', formData);
			
			const previewHeader = document.getElementById("previewHeader");
			const previewBody = document.getElementById("previewBody");
			const previewFooter = document.getElementById("previewFooter");
			
			// Replace placeholders {0}, {1}, etc., with values from formData
			if (previewHeader) {
				previewHeader.innerHTML = previewHeader.innerHTML.replace(/\{(\d+)\}/g, (match, index) => {
					return formData[index] || match; // Replace with selected value or keep the placeholder
				});
			}
			
			if (previewBody) {
				previewBody.innerHTML = previewBody.innerHTML.replace(/\{(\d+)\}/g, (match, index) => {
					return formData[index] || match;
				});
			}
			
			if (previewFooter) {
				previewFooter.innerHTML = previewFooter.innerHTML.replace(/\{(\d+)\}/g, (match, index) => {
					return formData[index] || match;
				});
			}
		}
		
		
		function handleSubmit () {
			const formData = {};
			document.querySelectorAll('.input-variable').forEach(inputElement => {
				const variable = inputElement.getAttribute('data-variable');
				formData[variable] = inputElement.value || '';
			});
			
			console.log("Form Submitted", formData);
			
			// You can now send formData to the backend
			// For example, using fetch or AJAX
		}
		
		// console.log('templateData:', templateData);
	</script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	
	<script src="assets/plugins/pace/pace.min.js" type="text/javascript"></script>
	<!--  A polyfill for browsers that don't support ligatures: remove liga.js if not needed-->
	<script src="assets/plugins/liga.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery/jquery-3.2.1.min.js" type="text/javascript"></script>
	<script src="assets/plugins/modernizr.custom.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
	<script src="assets/plugins/popper/umd/popper.min.js" type="text/javascript"></script>
	<script src="assets/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery/jquery-easy.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery-unveil/jquery.unveil.min.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery-ios-list/jquery.ioslist.min.js" type="text/javascript"></script>
	<script src="assets/plugins/jquery-actual/jquery.actual.min.js"></script>
	<script src="assets/plugins/jquery-scrollbar/jquery.scrollbar.min.js"></script>
	<script type="text/javascript" src="assets/plugins/select2/js/select2.full.min.js"></script>
	<script type="text/javascript" src="assets/plugins/classie/classie.js"></script>
	<script src="pages/js/pages.js" type="text/javascript"></script>
	<script src="assets/js/scripts.js" type="text/javascript"></script>
</body>
<% } %>

</html>