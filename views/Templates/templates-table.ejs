<% if (list.length > 0) { %>
<div class="p-4">
	<!-- Responsive Table -->
	<div class="overflow-x-auto">
		<table class="min-w-full divide-y divide-gray-200 border-separate border-spacing-y-2">
			<thead class="bg-gray-100">
				<tr class="text-sm text-left font-medium text-gray-700 tracking-wider">
					<th class="px-6 py-3">Sno.</th>
					<th class="px-6 py-3">Template Name</th>
					<th class="px-6 py-3">Category</th>
					<!-- <th class="px-6 py-3">Language</th> -->
					<th class="px-6 py-3">Status</th>
					<th class="px-6 py-3">Actions</th>
				</tr>
			</thead>
			<tbody>
				<!-- Row 1 -->
				
				<% list.forEach((list) => { %>
				<tr class="hover:bg-blue-100 border rounded-lg">
					<td class="px-6 py-4 text-sm text-gray-900">1</td>
					<td class="px-6 py-4">
						<a href="#" class="text-blue-600 hover:underline">
							<div>
								<p class="text-gray-900 font-semibold"><%= list.templateName %></p>
								<!-- Pass the raw createdAt timestamp -->
								<p class="text-gray-500 text-sm" id="createdAt-<%= list._id %>" data-timestamp="<%= list.createdAt %>"></p>
							</div>
							
						</a>
					</td>
					<td class="px-6 py-4 text-sm text-gray-900"><%= list.category %></td>
					<!-- <td class="px-6 py-4">
            <span class="inline-block px-2 py-1 text-xs font-semibold bg-yellow-200 text-yellow-800 rounded-full">Indonesia</span>
          </td> -->
					<td class="px-6 py-4">
						<span class="text-orange-500 font-semibold"><%= list.status %></span>
					</td>
					<td class="px-6 py-4">
						<!-- Duplicate Button -->
						<button type="button" class="text-gray-500 hover:text-gray-700 px-2" onclick="duplicateTemplate('<%= list._id %>')">
							<i class="fas fa-copy"></i>
						</button>
						
						<!-- Delete Button -->
						<button type="button" class="text-red-500 hover:text-red-700 px-2" onclick="confirmDelete('<%= list._id %>')">
							<i class="fas fa-trash"></i>
						</button>
					</td>
				</tr>
				<% }) %>
				
			</tbody>
		</table>
	</div>
	
	<!-- Pagination -->
	<div class="flex items-center justify-center py-4 space-x-4">
		<nav class="flex items-center">
			<ul class="flex space-x-1">
				<!-- Previous Button -->
				<li>
					<a href="/contact-list?page=<%= page > 1 ? page - 1 : 1 %>" class="px-3 py-2 rounded-md text-sm font-medium text-gray-500 bg-white border border-gray-300 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed" <%= page === 1 ? 'aria-disabled="true"' : '' %>>‹</a>
				</li>
				
				<!-- First Page Button -->
				<li>
					<a href="/template?page=1" class="px-3 py-2 rounded-md text-sm font-medium <%= page === 1 ? 'text-white bg-blue-600 border-blue-600' : 'text-gray-700 bg-white border-gray-300 hover:bg-gray-50' %>">1</a>
				</li>
				
				<% if (page > 3) { %>
				<!-- Show "..." if current page is greater than 3 -->
				<li><span class="px-3 py-2 text-sm text-gray-500">...</span></li>
				<% } %>
				
				<!-- Dynamic Page Numbers based on current page -->
				<% for (let i = Math.max(2, page - 1); i <= Math.min(totalPages - 1, page + 1); i++) { %>
				<li>
					<a href="/template?page=<%= i %>" class="px-3 py-2 rounded-md text-sm font-medium <%= i === page ? 'text-white bg-blue-600 border-blue-600' : 'text-gray-700 bg-white border-gray-300 hover:bg-gray-50' %>"><%= i %></a>
				</li>
				<% } %>
				
				<% if (page < totalPages - 2) { %>
				<!-- Show "..." if there are more pages -->
				<li><span class="px-3 py-2 text-sm text-gray-500">...</span></li>
				<% } %>
				
				<!-- Last Page Button -->
				<% if (totalPages > 1) { %>
				<li>
					<a href="/tempalte?page=<%= totalPages %>" class="px-3 py-2 rounded-md text-sm font-medium <%= page === totalPages ? 'text-white bg-blue-600 border-blue-600' : 'text-gray-700 bg-white border-gray-300 hover:bg-gray-50' %>"><%= totalPages %></a>
				</li>
				<% } %>
				
				<!-- Next Button -->
				<li>
					<a href="/template?page=<%= page < totalPages ? page + 1 : totalPages %>" class="px-3 py-2 rounded-md text-sm font-medium text-gray-700 bg-white border border-gray-300 hover:bg-gray-50">›</a>
				</li>
			</ul>
		</nav>
		
		<!-- "Go to page" input -->
		<div class="flex items-center space-x-2">
			<span class="text-sm text-gray-700">Go to page</span>
			<input type="number" min="1" max="<%= totalPages %>" class="w-16 px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" value="<%= page %>" id="pageInput" />
			<button type="button" class="px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2" onclick="goToPage()">Go</button>
		</div>
	</div>
	
	<script>
		function goToPage () {
			const pageInput = document.getElementById('pageInput');
			const page = parseInt(pageInput.value);
			const totalPages = <%= totalPages %>;
			
			if (page > totalPages) {
				alert("Page doesn't exist. Try a lower number.");
				pageInput.value = <%= page %>; // Reset input to the current page
			} else if (page < 1) {
				alert("Page number should be at least 1.");
				pageInput.value = <%= page %>;
			} else {
				window.location.href = `/contact-list?page=${page}`;
			}
		}
	</script>
	
	
	
</div>
<% } else { %>
<div class="flex flex-col items-center justify-center min-h-[400px]  rounded-lg mt-4">
	<div class="text-center">
		<img src="https://img.freepik.com/free-vector/hands-holding-tablet-with-forefinger-clicking-start-button-new-application-launch-flat-illustration_74855-20595.jpg?ga=GA1.1.131490893.1732525963&semt=ais_hybrid" alt="No contacts" class="w-48 h-48 mx-auto mb-4">
		
		<h3 class="text-xl font-semibold text-gray-900 mb-2">No Templates yet</h3>
		<p class="text-gray-600 mb-6">Start adding templates by clicking on "Create new template"</p>
		<button class="bg-black p-2 flex items-center rounded-lg text-base font-thin w-full justify-center" onclick="document.location='create-template'">
			<i class="pg-icon font-thin px-2">add</i>
			Create new template
		</button>
	</div>
</div>
<% } %>


<script>
	// Helper function to format date in "29 Aug-2024 at 02:05 AM" format
	function formatTimestamp (timestamp) {
		const date = new Date(timestamp);
		const options = {
			day: '2-digit',
			month: 'short',
			year: 'numeric',
			hour: '2-digit',
			minute: '2-digit',
			hour12: true
		};
		
		// Format the date and time string
		let formattedDate = date.toLocaleString('en-GB', options);
		formattedDate = formattedDate.replace(',', ' at ');
		return formattedDate;
	}
	
	// Format all timestamps with the 'data-timestamp' attribute
	document.querySelectorAll('[data-timestamp]').forEach((element) => {
		const timestamp = element.getAttribute('data-timestamp');
		element.textContent = formatTimestamp(timestamp);
	});
	
	function duplicateTemplate (templateId) {
		fetch(`/api/templates/duplicate/${templateId}`, {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json',
				},
			})
			.then((response) => response.json())
			.then((data) => {
				if (data.success) {
					// Redirect or refresh the page to see the duplicated template
					window.location.reload();
				} else {
					alert('Error duplicating template: ' + data.error);
				}
			})
			.catch((error) => console.error('Error:', error));
	}
	
	// Function to confirm deletion
	function confirmDelete (templateId) {
		if (confirm('Are you sure you want to delete this template?')) {
			fetch(`/api/templates/delete/${templateId}`, {
					method: 'DELETE',
					headers: {
						'Content-Type': 'application/json',
					},
				})
				.then((response) => response.json())
				.then((data) => {
					if (data.success) {
						window.location.reload();
					} else {
						alert('Error deleting template: ' + data.error);
					}
				})
				.catch((error) => console.error('Error:', error));
		}
	}
</script>