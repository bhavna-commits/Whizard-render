<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html;charset=UTF-8" />
	<meta charset="utf-8" />
	<title>User Management</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no" />
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet" />
	<!-- <script src="https://viralpitch.co/insights/app/js/apexcharts-bundle/dist/apexcharts.js"></script> -->
	<!-- <link rel="stylesheet" href="styles/template.css" /> -->
	<!-- <link rel="stylesheet" href="https://viralpitch.co/insights/app/js/apexcharts-bundle/dist/apexcharts.css" /> -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
	<link href="styles/style.css" rel="stylesheet" type="text/css" />
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script> -->
	<script src="https://cdn.tailwindcss.com"></script>
	<!-- <link rel="stylesheet" type="text/css" href="styles/template-preview.css" /> -->
</head>

<body>
	<!-- Loader HTML -->
	<div id="loader" class="loader">
		<div class="w-full h-full flex justify-center items-center">
			<img src="/assets/img/Wizard_logo.png" alt="Whizard Logo" class="animate-pulse loading-image" />
		</div>
	</div>
	
	<div class="layout-container">
		<nav class="sidebar">
			<div class="logo py-3">
				<img src="/assets/img/Wizard_logo.png" alt="Whizard Logo" />
			</div>
			<ul class="mt-4 space-y-4">
				<li>
					<a href="/" class=""><span class="icon"><i class="fas fa-chart-line"></i></span>
						Dashboard</a>
				</li>
				<li class="">
					<a href="/chats"><span class="icon"><i class="fa-regular fa-comment"></i></span>
						Chats</a>
				</li>
				<li class="">
					<a href="/contact-list"><span class="icon "><i class="fa-regular fa-address-book"></i></span>
						
						Contact List</a>
				</li>
				<li class="">
					<a href="/template"><span class="icon "><i class="fa-regular fa-envelope"></i></span>
						Template</a>
				</li>
				<li class="">
					<a href="/settings"><span class="icon active"><i class="fa-regular fa-user"></i></span>
						Settings</a>
				</li>
				<li class="py-1">
					<a href="/reports/campaign-list"><span class="icon"><i class="fa-regular fa-chart-bar"></i></span>
						Reports</a>
				</li>
			</ul>
			<div class="user-profile " onclick="toggleDropdown()">
				<img src="https://via.placeholder.com/50" alt="User Profile" />
				<div id="dropdownMenu" class="account-menu hidden">
					<a href="/settings/profile">Profile</a>
					<button onclick="logout()">Logout</button>
				</div>
			</div>
			
			
			<script>
				function toggleDropdown () {
					const dropdown = document.getElementById("dropdownMenu");
					dropdown.classList.toggle("hidden");
				}
				
				async function logout () {
					try {
						const response = await fetch('/api/users/logout', {
							method: 'POST',
							credentials: 'same-origin'
						});
						
						if (response.ok) {
							window.location.href = '/login';
						} else {
							alert('Error logging out.');
						}
					} catch (err) {
						console.error('Error:', err);
						alert('Error logging out.');
					}
				}
				
				// Close the dropdown if clicked outside
				window.onclick = function (event) {
					const dropdown = document.getElementById("dropdownMenu");
					if (!event.target.closest('.user-profile')) {
						dropdown.classList.add("hidden");
					}
				};
			</script>
		</nav>
		<!-- END SIDEBAR MENU TOP TRAY CONTENT-->
		
		<!-- START PAGE-CONTAINER -->
		<div class="main-content  p-2">
			<!-- END HEADER -->
			<div class="logo flex justify-between items-center">
				
				<!-- START BREADCRUMB -->
				<nav class="flex px-3  mt-4" aria-label="Breadcrumb">
					
					<div class="flex items-center">
						<a href="/settings" class="text-gray-500 hover:text-gray-700 text-xl font-medium">Settings</a>
						<svg class="w-4 h-4 mx-2 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L11.586 10 7.293 5.707a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
						</svg>
					</div>
					
					<div class="flex items-center">
						<a href="/settings/user-management" class="text-red-500 hover:text-gray-700 text-xl font-medium ">User Management</a>
						
					</div>
					
				</nav>
				<div class="mt-4 space-x-4 px-3">
					<button type="button" id="createNewPermissions" onclick="location.href = '/settings/user-management/permissions'" class="inline-flex items-center px-3 py-[10px] border border-transparent text-sm font-medium rounded-md text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
						<i class="fa-solid fa-plus pr-2"></i>
						<span>Add New Permissions</span>
					</button>
					<button type="button" id="AddNewUserSmall" onclick="AddUser()" class="inline-flex items-center px-3 py-[10px] border border-transparent text-sm font-medium rounded-md text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
						<i class="fa-solid fa-plus pr-2"></i>
						<span>Add New User</span>
					</button>
				</div>
				
			</div>
			
			
			<div class="container mx-auto bg-white p-6 rounded-lg">
				
				<% if (users.length > 0) { %>
				<table class="table-auto w-full text-left border-collapse">
					<thead>
						<tr class="text-gray-700">
							<th class="p-4 border-b">Sno.</th>
							<th class="p-4 border-b">User Name</th>
							<th class="p-4 border-b">Email</th>
							<th class="p-4 border-b">Role</th>
							<th class="p-4 border-b">Status</th>
							<th class="p-4 border-b">Actions</th>
						</tr>
					</thead>
					<tbody>
						<% users.forEach((user, index) => { %>
						<tr class="text-gray-900">
							<td class="p-4 border-b"><%= index + 1 %></td>
							<td class="p-4 border-b"><%= user.name %></td>
							<td class="p-4 border-b"><%= user.email %></td>
							<td class="p-4 border-b"><%= user.role %></td>
							<td class="p-4 border-b">
								<% if (user.status === 'Active') { %>
								<span class="text-orange-500 font-bold"><%= user.status %></span>
								<% } else { %>
								<span class="text-gray-500 font-bold"><%= user.status %></span>
								<% } %>
							</td>
							<td class="p-4 border-b">
								<div class="relative">
									<button class="text-gray-500 hover:text-gray-900 focus:outline-none" onclick="toggleDropdown(<%= index %>)">
										&#x22EE;
									</button>
									<div id="dropdown-<%= index %>" class="hidden absolute bg-white border rounded-lg shadow-lg w-40 right-0 z-10">
										<button class="block w-full px-4 py-2 text-left text-gray-700 hover:bg-gray-100" onclick="updateStatus(<%= index %>, 'Inactive')">Mark as Unactive</button>
										<button class="block w-full px-4 py-2 text-left text-gray-700 hover:bg-gray-100" onclick="updateRole(<%= index %>)">Update Role</button>
										<button class="block w-full px-4 py-2 text-left text-red-500 hover:bg-gray-100" onclick="deleteUser(<%= index %>)">Delete User</button>
									</div>
								</div>
							</td>
						</tr>
						<% }) %>
					</tbody>
				</table>
				<% } else { %>
				<!-- Empty state -->
				<div class="flex flex-col items-center justify-center min-h-[400px]  rounded-lg mt-4">
					<div class="text-center">
						<img src="https://img.freepik.com/free-vector/hands-holding-tablet-with-forefinger-clicking-start-button-new-application-launch-flat-illustration_74855-20595.jpg?ga=GA1.1.131490893.1732525963&semt=ais_hybrid" alt="No contacts" class="w-48 h-48 mx-auto mb-4">
						
						<h3 class="text-xl font-semibold text-gray-900 mb-2">No members yet</h3>
						<p class="text-gray-600 mb-6">Start adding users by clicking on "Add New User"</p>
						<button type="button" id="AddNewUser" onclick="AddUser()" class="inline-flex items-center px-3 py-[10px] border border-transparent text-sm font-medium rounded-md text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black">
							<i class="fa-solid fa-plus pr-2"></i>
							<span>Add New User</span>
						</button>
					</div>
				</div>
				<% } %>
			</div>
			
			
			<script>
				function toggleDropdown (index) {
					const dropdown = document.getElementById('dropdown-' + index);
					dropdown.classList.toggle('hidden');
				}
				
				function updateStatus (index, status) {
					alert(`Mark user ${index + 1} as ${status}`);
					// Add logic to update user status
				}
				
				function updateRole (index) {
					alert(`Update role for user ${index + 1}`);
					// Add logic to update user role
				}
				
				function deleteUser (index) {
					const confirmation = confirm(`Are you sure you want to delete user ${index + 1}?`);
					if (confirmation) {
						alert(`User ${index + 1} deleted`);
						// Add logic to delete user
					}
				}
				
				// Close dropdown on clicking outside
				window.onclick = function (event) {
					if (!event.target.matches('button')) {
						document.querySelectorAll("[id^='dropdown']").forEach(dropdown => {
							dropdown.classList.add('hidden');
						});
					}
				}
			</script>
		</div>
	</div>
	<%- include("partials/addUser")  %>
	<script>
		window.addEventListener('load', function () {
			// Fade out the loader smoothly by changing the opacity
			var loader = document.getElementById('loader');
			loader.style.transition = 'opacity 0.5s ease'; // Smooth fade out
			loader.style.opacity = '0';
			
			// Completely remove the loader after the fade-out effect is finished
			setTimeout(function () {
				loader.style.display = 'none'; // Ensure loader is no longer in the DOM flow
			}, 300); // Match the duration of the fade-out (0.5 seconds in this case)
		});
	</script>
</body>


</html>