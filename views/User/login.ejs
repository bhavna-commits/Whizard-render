<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<title>Login</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=yes" />
	<link rel="apple-touch-icon" href="pages/ico/60.png" />
	<link rel="apple-touch-icon" sizes="76x76" href="pages/ico/76.png" />
	<link rel="apple-touch-icon" sizes="120x120" href="pages/ico/120.png" />
	<link rel="apple-touch-icon" sizes="152x152" href="pages/ico/152.png" />
	<link rel="icon" type="image/x-icon" href="favicon.ico" />
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="apple-touch-fullscreen" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="default" />
	<meta content="Meet pages - The simplest and fastest way to build web UI for your dashboard or app." name="description" />
	<meta content="Ace" name="author" />
	<link href="assets/plugins/pace/pace-theme-flash.css" rel="stylesheet" type="text/css" />
	<link href="assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
	<link href="assets/plugins/jquery-scrollbar/jquery.scrollbar.css" rel="stylesheet" type="text/css" media="screen" />
	<link href="assets/plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" media="screen" />
	<!-- <link class="main-stylesheet" href="pages/css/themes/corporate.css" rel="stylesheet" type="text/css" /> -->
	<!-- Please remove the file below for production: Contains demo classes -->
	<link class="main-stylesheet" href="assets/css/style.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="/styles/style.css" />
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
	<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" />
	<script src="https://cdn.tailwindcss.com"></script>
	<link rel="stylesheet" href="/styles/countrySelector.css" />
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
	<script src="https://kit.fontawesome.com/44e4e59292.js" crossorigin="anonymous"></script>
	<style>
		.loading-spinner {
			border: 3px solid rgba(0, 0, 0, 0.1);
			border-left-color: #fff;
			border-radius: 100%;
			width: 16px;
			height: 16px;
			animation: spin 1s linear infinite;
		}
		
		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}
			
			100% {
				transform: rotate(360deg);
			}
		}
		
		#errorMessage,
		#successMessage {
			margin-top: 10px;
			display: none;
		}
		
		#errorMessage {
			color: red;
		}
		
		#successMessage {
			color: green;
		}
	</style>
</head>

<body>
	<div id="loader" class="loader">
		<div class="w-full h-full flex justify-center items-center">
			<img src="/assets/img/Wizard_logo.png" alt="Whizard Logo" class="animate-pulse loading-image" />
		</div>
	</div>
	<div class="layout-container">
		<!-- Left Section -->
		<div class="flex-grow left-section">
			<div class="mb-5">
				<img src="./assets/img/Wizard_logo.png" alt="Whizard Logo" style="max-width: 150px;" class="w-25">
			</div>
			<h1 class="gradient-text">Smart WhatsApp solutions for effortless business</h1>
			<p class="p-text">Whizard helps businesses enhance WhatsApp communication by simplifying template creation, reporting, and integration seamlessly with other platforms.</p>
			<div class="img-preview">
				<img src="./assets/img/template.png" class="w-75" alt="Template Preview">
			</div>
		</div>
		
		<!-- Right Section - Login Form -->
		<div class="flex-shrink right-section p-5">
			<div class="text-center">
				<h3 class="mb-2 text-3xl">Sign In</h3>
				<p class="p-text text-lg">Enter your email address and password to sign in!</p>
			</div>			
			<form id="signInForm" class="sign-in-form">
				<div class="form-group">
					<label class="p-text" for="email">Email</label>
					<input type="email" class="form-control placeholder:text-gray-400" id="email" name="email" placeholder="Enter email address" required>
					<div class="invalid-feedback">Enter a valid email</div>
				</div>
				
				<div class="form-group">
					<label class="p-text" for="password">Password</label>
					<div class="input-group form-control ">
						<input type="password" class="w-[95%] placeholder:text-gray-400" id="password" name="password" placeholder="Enter password" required />
						<i id="togglePassword" class="fa-regular cursor-pointer text-gray-400 fa-eye pt-1"></i>
					</div>
				</div>
				
				<div class="form-group d-flex justify-content-between">
					<div class="remember-me">
						<input type="checkbox" id="remember-me">
						<label class="p-text" for="remember-me">Remember me</label>
					</div>
					<a href="resetPassword" class="forgot-password">Forgot password?</a>
				</div>
				
				<button type="submit" class="btn btn-primary">Sign In</button>
				<p class="text-center py-2  text-gray-500">Don't have an account yet ? <a href="/register" class="text-blue-500">Register here</a></p>
			</form>
      <div class="text-center" id="errorMessage">Error: Invalid login details.</div>
      <div class="text-center" id="successMessage">Success: Logging in...</div>
		</div>
	</div>
	
	<script>
		// Toggle password visibility
		document.getElementById('togglePassword').addEventListener('click', function () {
			const passwordInput = document.getElementById('password');
			const icon = document.getElementById('togglePassword');
			
			if (passwordInput.type === 'password') {
				passwordInput.type = 'text';
				icon.classList.add('fa-eye-slash');
				icon.classList.remove('fa-eye');
			} else {
				passwordInput.type = 'password';
				icon.classList.remove('fa-eye-slash');
				icon.classList.add('fa-eye');
			}
		});
		
		// Handle form submission with fetch API
		document.getElementById('signInForm').addEventListener('submit', async function (e) {
			e.preventDefault(); // Prevent default form submission
			
			// Get form values
			const email = document.getElementById('email').value;
			const password = document.getElementById('password').value;
			const rememberMe = document.getElementById('remember-me').checked;
			
			// Clear any previous messages
			document.getElementById('errorMessage').style.display = 'none';
			document.getElementById('successMessage').style.display = 'none';
			
			try {
				// Make API call to login route
				const response = await fetch('/api/users/login', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/json',
					},
					body: JSON.stringify({
						email,
						password,
						rememberMe
					}),
				});
				
				const data = await response.json();
				
				if (response.ok) {
					// Show success message
					document.getElementById('successMessage').style.display = 'block';
					
					// Remember email if the "Remember Me" checkbox is checked
					if (rememberMe) {
						localStorage.setItem('rememberedEmail', email);
					} else {
						localStorage.removeItem('rememberedEmail');
					}
					
					// Redirect to the dashboard
					setTimeout(() => {
						window.location.href = '/';
					}, 1500); // Redirect after 1.5 seconds
				} else {
					// Show error message
					document.getElementById('errorMessage').textContent = data.message;
					document.getElementById('errorMessage').style.display = 'block';
				}
			} catch (error) {
				// Handle errors
				document.getElementById('errorMessage').textContent = 'An error occurred. Please try again.';
				document.getElementById('errorMessage').style.display = 'block';
			}
		});
		
		// Remember email if it's stored in localStorage
		window.addEventListener('DOMContentLoaded', (event) => {
			const rememberedEmail = localStorage.getItem('rememberedEmail');
			if (rememberedEmail) {
				document.getElementById('email').value = rememberedEmail;
				document.getElementById('remember-me').checked = true;
			}
		});
	</script>
	
	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<script>
		window.addEventListener('load', function () {
			// Fade out the loader smoothly by changing the opacity
			var loader = document.getElementById('loader');
			loader.style.transition = 'opacity 0.3s ease'; // Smooth fade out
			loader.style.opacity = '0';
			
			// Completely remove the loader after the fade-out effect is finished
			setTimeout(function () {
				loader.style.display = 'none'; // Ensure loader is no longer in the DOM flow
			}, 300); // Match the duration of the fade-out (0.5 seconds in this case)
		});
	</script>
</body>

</html>